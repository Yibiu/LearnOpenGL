# 第五章 视口变换、裁剪与反馈

[TOC]



建议先看《LearnOpenGL》中坐标系统和相机系统相关部分，可以很好地理解OpenGL使用的坐标系统和矩阵变换。

## 一：用户变换

介绍OpenGL变换一些基本理论：

- 矩阵乘法：矩阵基本运算；

- 齐次坐标：平时使用的笛卡尔坐标为三维坐标，可扩展为四维坐标即齐次坐标。所谓齐次坐标可以认为是升维坐标。坐标升维有如下好处：其一：可以完成更多变换，例如透视变换；其二，可以使用线性变换来实现模型平移。总之，四维坐标可以完成所有我们希望的计算。

  **齐次坐标总是有一个额外的分量，并且如果所有分量都除以一个相同的值，那么不会改变它所表达的坐标位置，可以理解为：齐次坐标表达的是低一维的方向，而不是位置。** (x, y, z)构建为齐次坐标(x, y, z, w) -> (x, y, z, 1.0)。

- 线性变换：平移、缩放、旋转、透视投影和正交投影；

- 法线变换：OpenGL进行非比例线性变换时会导致法线变化，而要矫正法线单纯进行相同的变换是不可以的，需要单独变换。





## 二：OpenGL变换

- 视口变换：在指定的矩形观察区域内显示数据；视口是缩放整个内容以适应窗口，不同于裁剪；
- 多视口变换；
- 用户裁剪和剪切。





## 三：Transform feedback

在原来的OpenGL渲染的pipeline并没有提供较多的交互接口，当调用Draw函数之后很难再绘制过程对已经装配的图元进行修改。然而，在绘制过程中存在这样的需求，尤其是需要根据之前装配好的图元来更新随后的操作。举个简单的例子，当一个场景中存在两个相对运动的物体时，后一个物体需要根据前一个物体的运动来决定自己的运动轨迹，因此需要有一种feed back来提升交互能力。Transform feed back就是这样一种有效的机制，Transform feed back在顶点处理好之后，图元装配和光栅化之前给程序员提供的一个接口。主要利用一个feed back缓存返回之前顶点的状态，在下一步处理中就可以根据顶点信息有效的计算下一步的运动轨迹。

总而言之，Transform feedback系统是OpenGL绘制的回调，使用这个系统可以及时捕捉和修改下一次的绘制，从而完成"自动"的效果。最具典型的应用是《粒子系统》。







